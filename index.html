<!DOCTYPE html>
<html>
<head>
  <title>Digital VCard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body{
      margin:0;
      font-family:Arial, sans-serif;
      background:#e9eef6;
      display:flex;
      justify-content:center;
    }
    .vcard{
      width:100%;
      max-width:420px;
      background:#f2f5fb;
      min-height:100vh;
    }

    /* HERO */
    .hero{
      background:#5b8cff;
      color:#fff;
      text-align:center;
      padding:35px 20px 25px;
    }
    .hero img{
      width:120px;
      height:120px;
      border-radius:50%;
      border:4px solid #fff;
      object-fit:cover;
    }
    .hero h2{margin:10px 0 5px}
    .hero p{margin:2px;font-size:14px;opacity:.9}

    /* QUICK ICONS */
    .icon-actions{
      background:#fff;
      margin:-25px 15px 15px;
      border-radius:20px;
      padding:15px;
      display:flex;
      justify-content:space-around;
      box-shadow:0 4px 10px rgba(0,0,0,.1)
    }
    .icon-actions i{font-size:22px}
    .icon-actions a:nth-child(1) i{color:#5b8cff}
    .icon-actions a:nth-child(2) i{color:#25d366}
    .icon-actions a:nth-child(3) i{color:#e1306c}
    .icon-actions a:nth-child(4) i{color:#1877f2}

    /* CARD */
    .card{
      background:#fff;
      margin:15px;
      padding:18px;
      border-radius:18px;
      box-shadow:0 4px 10px rgba(0,0,0,.08)
    }

    /* GALLERY (BIGGER) */
    .gallery{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
    }
    .gallery img{
      width:100%;
      height:150px;
      border-radius:14px;
      object-fit:cover;
      cursor:pointer;
      transition:transform .2s;
    }
    .gallery img:hover{transform:scale(1.03)}

    /* LIGHTBOX */
    #lightbox{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.9);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      touch-action:none;
    }
    #lightbox img{
      max-width:90%;
      max-height:90%;
      transition:transform .2s;
    }
    .nav{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      font-size:32px;
      color:#fff;
      padding:10px;
      cursor:pointer;
      user-select:none;
    }
    .prev{left:10px}
    .next{right:10px}
    .close{
      position:absolute;
      top:12px;
      right:15px;
      font-size:26px;
      color:#fff;
      cursor:pointer;
    }

    iframe{width:100%;border-radius:15px;border:0}
    .hide{display:none}
  </style>
</head>

<body>
<div class="vcard">

<div class="hero">
  <img id="photo">
  <h2 id="name"></h2>
  <p id="title"></p>
  <p id="company"></p>
</div>

<div class="icon-actions">
  <a id="callBtn"><i class="fa-solid fa-phone"></i></a>
  <a id="whatsappBtn"><i class="fa-brands fa-whatsapp"></i></a>
  <a id="instagramBtn"><i class="fa-brands fa-instagram"></i></a>
  <a id="facebookBtn"><i class="fa-brands fa-facebook-f"></i></a>
</div>

<div class="card">
  <button onclick="saveContact()" style="width:100%;padding:12px;border:0;
  border-radius:12px;background:#5b8cff;color:#fff;font-size:16px">
    ➕ Add to Contacts
  </button>
</div>

<div class="card" id="galleryBox">
  <h3>Gallery</h3>
  <div class="gallery" id="gallery"></div>
</div>

</div>

<!-- LIGHTBOX -->
<div id="lightbox">
  <span class="close" onclick="closeLB()">✕</span>
  <span class="nav prev" onclick="prevImg()">❮</span>
  <img id="lbImg">
  <span class="nav next" onclick="nextImg()">❯</span>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbw9xyX1Zh388XgEiFu7ptEYbCBRvegAiwl6DbQqq2FAS1VWnI7DX4sI4pXCQ1quWpsftg/exec";
const slug=new URLSearchParams(location.search).get("slug");
if(!slug){document.body.innerHTML="Invalid URL";throw "";}

let galleryImages=[],current=0,scale=1,startDist=0;

fetch(API_URL+"?slug="+slug)
.then(r=>r.json())
.then(d=>{
 if(d.photo_url){
  photo.src=d.photo_url;
  photo.onerror=()=>photo.remove();
 }
 name.innerText=d.full_name||"";
 title.innerText=d.title||"";
 company.innerText=d.company||"";

 for(let i=1;i<=10;i++){
  if(d["gallery_"+i]){
   galleryImages.push(d["gallery_"+i]);
   gallery.innerHTML+=`
    <img src="${d["gallery_"+i]}"
     onclick="openLB(${galleryImages.length-1})"
     onerror="this.remove()">`;
  }
 }
 if(!galleryImages.length) galleryBox.remove();
});

/* LIGHTBOX FUNCTIONS */
const lb=document.getElementById("lightbox");
const lbImg=document.getElementById("lbImg");

function openLB(i){
 current=i; scale=1;
 lbImg.src=galleryImages[i];
 lb.style.display="flex";
}
function closeLB(){lb.style.display="none";}
function nextImg(){openLB((current+1)%galleryImages.length);}
function prevImg(){openLB((current-1+galleryImages.length)%galleryImages.length);}

/* SWIPE */
let startX=0;
lb.addEventListener("touchstart",e=>{
 if(e.touches.length==1) startX=e.touches[0].clientX;
 if(e.touches.length==2){
  let dx=e.touches[0].clientX-e.touches[1].clientX;
  let dy=e.touches[0].clientY-e.touches[1].clientY;
  startDist=Math.sqrt(dx*dx+dy*dy);
 }
});
lb.addEventListener("touchend",e=>{
 let dx=e.changedTouches[0].clientX-startX;
 if(dx>60) prevImg();
 if(dx<-60) nextImg();
 startDist=0;
});
lb.addEventListener("touchmove",e=>{
 if(e.touches.length==2){
  let dx=e.touches[0].clientX-e.touches[1].clientX;
  let dy=e.touches[0].clientY-e.touches[1].clientY;
  let dist=Math.sqrt(dx*dx+dy*dy);
  scale*=dist/startDist;
  lbImg.style.transform=`scale(${scale})`;
  startDist=dist;
 }
});
</script>
</body>
</html>
