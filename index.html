<!DOCTYPE html>
<html>
<head>
  <title>Digital VCard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body{
      margin:0;
      font-family:Arial, sans-serif;
      background:#e9eef6;
      display:flex;
      justify-content:center;
    }
    .vcard{
      width:100%;
      max-width:420px;
      background:#f2f5fb;
      min-height:100vh;
    }
    .hero{
      background:#5b8cff;
      color:#fff;
      text-align:center;
      padding:35px 20px 25px;
    }
    .hero img{
      width:110px;
      height:110px;
      border-radius:50%;
      border:4px solid #fff;
      object-fit:cover;
    }
    .hero h2{margin:10px 0 5px}
    .hero p{margin:2px;font-size:14px;opacity:.9}

    .icon-actions{
      background:#fff;
      margin:-25px 15px 15px;
      border-radius:20px;
      padding:15px;
      display:flex;
      justify-content:space-around;
      box-shadow:0 4px 10px rgba(0,0,0,.1)
    }
    .icon-actions i{font-size:22px}
    .icon-actions a:nth-child(1) i{color:#5b8cff}
    .icon-actions a:nth-child(2) i{color:#25d366}
    .icon-actions a:nth-child(3) i{color:#e1306c}
    .icon-actions a:nth-child(4) i{color:#1877f2}

    .card{
      background:#fff;
      margin:15px;
      padding:18px;
      border-radius:18px;
      box-shadow:0 4px 10px rgba(0,0,0,.08)
    }

    .hours{list-style:none;padding:0;margin:0}
    .hours li{
      display:flex;justify-content:space-between;
      padding:6px 0;border-bottom:1px solid #eee;
      font-size:14px
    }

    .gallery{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:8px;
    }
    .gallery img{
      width:100%;
      border-radius:10px;
      object-fit:cover;
    }

    iframe{width:100%;border-radius:15px;border:0}

    .links a{
      display:flex;align-items:center;gap:10px;
      padding:10px;background:#f2f5fb;
      margin-bottom:8px;border-radius:12px;
      text-decoration:none;color:#333;font-size:14px;
    }
    .icon{
      width:32px;height:32px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      color:#fff;
    }
    .wa{background:#25d366}
    .ig{background:#e1306c}
    .fb{background:#1877f2}
    .li{background:#0077b5}
    .web{background:#5b8cff}

    .hide{display:none}
  </style>
</head>

<body>
<div class="vcard">

<div class="hero">
  <img id="photo">
  <h2 id="name"></h2>
  <p id="title"></p>
  <p id="company"></p>
</div>

<div class="icon-actions">
  <a id="callBtn"><i class="fa-solid fa-phone"></i></a>
  <a id="whatsappBtn"><i class="fa-brands fa-whatsapp"></i></a>
  <a id="instagramBtn"><i class="fa-brands fa-instagram"></i></a>
  <a id="facebookBtn"><i class="fa-brands fa-facebook-f"></i></a>
</div>

<div class="card">
  <button onclick="saveContact()" style="width:100%;padding:12px;border:0;
  border-radius:12px;background:#5b8cff;color:#fff;font-size:16px">
    âž• Add to Contacts
  </button>
</div>

<div class="card" id="aboutBox">
  <h3>About</h3>
  <p id="about"></p>
</div>

<div class="card" id="contactBox">
  <p><b>Name:</b> <span id="fullName"></span></p>
  <p><b>Address:</b> <span id="address"></span></p>
  <p><b>WhatsApp:</b> <span id="whatsappText"></span></p>
  <h4>Hours</h4>
  <ul class="hours" id="hoursList"></ul>
  <div id="mapBox"></div>
</div>

<div class="card" id="linksBox">
  <h3>Links</h3>
  <div class="links" id="links"></div>
</div>

<div class="card" id="galleryBox">
  <h3>Gallery</h3>
  <div class="gallery" id="gallery"></div>
</div>

<div class="card" id="videoBox">
  <h3>Video</h3>
  <iframe id="videoFrame" height="200"></iframe>
</div>

</div>

<script>
let DATA=null;
const API_URL="https://script.google.com/macros/s/AKfycbw9xyX1Zh388XgEiFu7ptEYbCBRvegAiwl6DbQqq2FAS1VWnI7DX4sI4pXCQ1quWpsftg/exec";

const slug=new URLSearchParams(location.search).get("slug");
if(!slug){document.body.innerHTML="Invalid URL";throw "";}

fetch(API_URL+"?slug="+slug)
.then(r=>r.json())
.then(d=>{
 if(d.error){document.body.innerHTML=d.error;return;}
 DATA=d;

 if(d.photo_url){
   photo.src=d.photo_url;
   photo.onerror=()=>photo.remove();
 }else photo.remove();

 name.innerText=d.full_name||"";
 title.innerText=d.title||"";
 company.innerText=d.company||"";

 if(d.about) about.innerText=d.about;
 else aboutBox.remove();

 fullName.innerText=d.full_name||"";
 address.innerText=d.address||"";
 whatsappText.innerText=d.whatsapp||"";

 hoursList.innerHTML="";
 ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]
 .forEach(day=>{
  if(d["hours_"+day]){
    hoursList.innerHTML+=`<li><span>${day}</span><span>${d["hours_"+day]}</span></li>`;
  }
 });

 if(d.map_iframe) mapBox.innerHTML=d.map_iframe;
 else mapBox.remove();

 callBtn.href=d.phone?"tel:"+d.phone:"#";
 whatsappBtn.href=d.whatsapp?"https://wa.me/"+d.whatsapp.replace(/\D/g,""):"#";
 instagramBtn.href=d.instagram||"#";
 facebookBtn.href=d.facebook||"#";

 links.innerHTML="";
 addLink("Instagram",d.instagram,"fa-instagram ig");
 addLink("Facebook",d.facebook,"fa-facebook-f fb");
 addLink("LinkedIn",d.linkedin,"fa-linkedin-in li");
 addLink("Website",d.website,"fa-globe web");
 if(!links.innerHTML.trim()) linksBox.remove();

 gallery.innerHTML="";
 for(let i=1;i<=10;i++){
   const k="gallery_"+i;
   if(d[k]){
     gallery.innerHTML+=`<img src="${d[k]}" onerror="this.remove()">`;
   }
 }
 if(!gallery.innerHTML.trim()) galleryBox.remove();

 if(d.video_url) videoFrame.src=d.video_url;
 else videoBox.remove();

 history.replaceState(null,"","/business-card/"+slug);
});

function addLink(label,url,icon){
 if(!url)return;
 links.innerHTML+=`
 <a href="${url}" target="_blank">
  <span class="icon ${icon.split(" ")[1]}">
   <i class="fa-brands ${icon.split(" ")[0]}"></i>
  </span>${label}
 </a>`;
}

function saveContact(){
 if(!DATA)return;
 const v=`BEGIN:VCARD
VERSION:3.0
FN:${DATA.full_name||""}
ORG:${DATA.company||""}
TITLE:${DATA.title||""}
TEL:${DATA.phone||""}
EMAIL:${DATA.email||""}
ADR:${DATA.address||""}
END:VCARD`;
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([v],{type:"text/vcard"}));
 a.download=(DATA.full_name||"contact")+".vcf";
 a.click();
}
</script>
</body>
</html>
